package org.rolson.emr.emrcycle1;


import java.util.Collection;
import java.util.List;

import com.amazonaws.services.elasticmapreduce.model.*;


public class Cluster {
	private String name;
	private String masterInstance;
	private String slaveInstance;
	private String logUri;
	private String ec2KeyName;
	private String serviceRole;
	private String jobFlowRole;
	private String subnetID;
	private String status; 
	private String releaseLabel;
	private RunJobFlowResult result;
	private RunJobFlowRequest request;
	private StepConfig stepConfig;
	private Collection<Application> applications;
	private List<Workflow> workflows;
	public Cluster() {
		defaultVariables();
	}
	public RunJobFlowResult getResult()
	{
		return result;
	}
	public void setResult(RunJobFlowResult rjfResult)
	{
		result = rjfResult;
	}
	public RunJobFlowRequest getRequest()
	{
		return request;
	}
	public void setRequest()
	{
		//set request for new cluster
		this.request = new RunJobFlowRequest()
		       .withName(this.name)
		       .withReleaseLabel(this.releaseLabel)
		       .withSteps(this.stepConfig)
		       .withLogUri(this.logUri)
		       .withServiceRole(this.serviceRole)
		       .withJobFlowRole(this.jobFlowRole)
		       .withInstances(new JobFlowInstancesConfig()
		           .withEc2KeyName(this.ec2KeyName)
		           .withInstanceCount(5)
		           .withKeepJobFlowAliveWhenNoSteps(true)
		           .withMasterInstanceType(this.masterInstance)
		           .withSlaveInstanceType(this.slaveInstance)
		           .withEc2SubnetId(this.subnetID));
	}
	public String getName()
	{
		return name;
	}
	public void setName(String newname)
	{
		name = newname;
	}
	public String getStatus()
	{
		return status;
	}
	public void setStatus(String newstatus)
	{
		status = newstatus;
	}
	private void defaultVariables()
	{
		this.masterInstance = "m4.large";
		this.slaveInstance = "m4.large";
		this.logUri = "s3://rolyhudsontestbucket1/climateData";
		this.ec2KeyName = "monday";
		this.serviceRole = "EMR_DefaultRole";
		this.jobFlowRole = "EMR_EC2_DefaultRole";
		this.subnetID = "subnet-da059bd5";
		this.status = "NEW"; 
		this.releaseLabel = "emr-5.14.0";
		setRequest();
	}
	public void addPredfined(String testtype)
	{
		Workflow wf;
		switch(testtype)
		{
		case "Hadoop Map Reduce":
			wf = new Workflow(testtype);
			//use the default wf settings
			break;
		case "K-means clustering":
			wf = new Workflow(testtype);
			//wf.sparkTestVariables();
			//configure for kmeans
			break;
		case "Linear Regression":
			wf = new Workflow(testtype);
			//configure for linear classification
			break;
		case "Message log agregator":
			wf = new Workflow(testtype);
			//configure for ...
			wf.messageLogAgregator();
			//configure for linear classification
			break;
		case "Monthly records totals":
			wf = new Workflow(testtype);
			//configure for ...
			wf.monthlyResultsConfig();
			//configure for linear classification
			break;
			default:
				wf = new Workflow(testtype);
				break;
		}
		addWorkflow(wf);
		
	}
	public void addWorkflow(Workflow wf)
	{
		this.stepConfig = wf.getStepConfig();
		this.workflows.add(wf);
		//workflowUpdate();
	}
	public Workflow getWorkflow(String name)
	{
		
	}
}

